from django.contrib import messages
from django.contrib.auth.decorators import login_required
from django.shortcuts import render, get_object_or_404, redirect, resolve_url
from django.utils import timezone

from ..forms import AnswerForm
from ..models import Question, Answer
import torch
from transformers import BertTokenizer, BertForSequenceClassification
from keras.preprocessing.sequence import pad_sequences
import numpy as np

lst = ["fuck","shit","18nom","18num","18ã……ã…ã„²ã…£","18ã……ã…ë¼","18ã……ã…”ã…‹ã…£","18ã……ã…”í‚¤","18ë…„","18ë†ˆ","18ìƒˆë¼","18ì„¸ã…‹ã…£","18ì„¸í‚¤","boji","bozi","dogbaby","dì¥ê³ ","dì§€ê³ ","jaji","jazi","jotê°™","meì·¬","meì¹œ","meí‹´","miì¹œ","mií‹´","sexí•˜ì","sexí•´","yadong","yaë™","zaji","zazi","ã…ã…Š","ã…ã…£ì·¬","ã…ì¹œ",
    "ã…‚ã„¹","ã…‚ã…ã„±","ã…‚ã…Š","ã…‚í¬","ã…„","ã…….ã…‚","ã……ã„²ë„¤","ã……ã„²ë“¤","ã……ã…‚","ã……ã…","ã……ã…‹","ã……ã…ã„²ã…£","ã……ã…¡ë£¨","ã……ë£¨","ã……ë°œ","ã…†ã„¹ã„±","ã…†ã„º","ã…†ã…‚","ã…†ã…£","ã…†ã…£8","ã…†ã…£ã…‚ã…",
    "ã…†ã…£ëŒ•","ã…†ã…£ë…","ã…†ã…£ë°”","ã…†ã…£ë°œ","ã…†ã…£íŒë„˜","ã…‡ã…ã…Šã…Œ","ã…‡ã…’ìœ","ã…ˆ.ã„´","ã…ˆã„´","ã…ˆã„¹","ã…ˆã…ìœ„","ã…ˆë¦¬","ã…‰ì§ˆí•œ","ã…Œã…“ã„¹ã…ã„±ã…£","å‡¸","ã„±ã……ã„²","ê°€ìŠ´ë§Œì ¸","ê°€ìŠ´ë¹¨ì•„",
    "ê°€ìŠ´ë¹¨ì–´","ê°€ìŠ´ì¡°ë¬¼ë½","ê°€ìŠ´ì£¼ë¬¼ëŸ­","ê°€ìŠ´ìª¼ë¬¼ë”±","ê°€ìŠ´ìª¼ë¬¼ë½","ê°€ìŠ´í•§ì•„","ê°€ìŠ´í•§ì–´","ê°•ê°„","ê°•ê°„í•œë‹¤","ê°™ì€ìƒˆë¼","ê°œ.ì›ƒ","ê°œê°€íŠ¼","ê°œê°€íŠ¼ë…„","ê°œê°€íŠ¼ë‡¬","ê°œê°„","ê°œê°™",
    "ê°œê°™ì€ë…„","ê°œê°™ì´","ê°œê±°ì–¼ë˜","ê°œê±°ì–¼ë ˆ","ê°œê±¸ë˜","ê°œê±¸ë ˆ","ê°œê³ ì¹˜","ê°œë„ˆë¯¸","ê°œë„·","ê°œë…„","ê°œë…ë¹ ê°€","ê°œë†ˆ","ê°œë…","ê°œë¼ìŠ¥","ê°œë ¨","ê°œë§ˆì´","ê°œë³´ì§€","ê°œë³´ì§€ë…„",
    "ê°œë¶€ë‹¬","ê°œë¶€ë„","ê°œë¶ˆë„","ê°œë¶•ì•Œ","ê°œìƒˆê¸°","ê°œìƒˆë¼","ê°œìƒ‰ë€Œ","ê°œìƒ‰íœ˜","ê°œìƒ›ê¸°","ê°œì„¹","ê°œì…ˆ","ê°œì†Œë¦¬","ê°œì‰ë€Œ","ê°œì“°ë˜ê¸°","ê°œì“°ë ˆê¸°","ê°œì”ë…„","ê°œì”ë¸”","ê°œì”ìì§€",
    "ê°œì”¨ë°œ","ê°œì”¨ë°œë„˜","ê°œì”¨ë°œììŠ¥","ê°œì”¨ë¸”","ê°œì•„ê¸°","ê°œì• ê±°ì–¼ë˜","ê°œì• ê±¸ë˜","ê°œì—ê°€íŠ¼","ê°œì—ê±°ì–¼ë˜","ê°œì—ê±¸ë˜","ê°œìì‹","ê°œìì§€","ê°œì‘ë‘ë„˜","ê°œì‘ë‘ë…„","ê°œì¡ë…„","ê°œì¡ì§€ë„",
    "ê°œì €ê°€íŠ¼","ê°œì €ì”¨","ê°œì €ì—‡","ê°œì “","ê°œì “ê°€íŠ¼ë„˜","ê°œì¢†","ê°œì§€ë„","ê°œì§€ë„ë„˜","ê°œì§€ë„ë†ˆ","ê°œì©Œ","ê°œí›„ë¼","ê°œí›„ë¼ë…„","ê°œí›„ë¼ë“¤ë†ˆ","ê°œí›„ë¼ìƒˆë¼","ê±”ì¡ë…„","ê±”ì¡ì§€ë„","ê±°ì‹œê¸°",
    "ê±°ì§€ê°™ì€","ê±¸ë˜ë…„","ê±¸ë ˆê°™ì€ë…„","ê±¸ë ˆë…„","ê±¸ë ˆë³´ì§€","ê±¸ë ˆí•€ë…„","ê²Œê°€íŠ¼","ê²Œë¶€ëŸ´","ê²Œì—ê°€íŠ¼","ê²Œì €ì—‡","ê²Œì “","ê²Œì§€ë„ë†ˆ","ê³„ìƒˆë¼","ê³¨ë¹ˆ","ê³µì•Œ","ê´˜ìƒˆë¼","ê´´ê°€íŠ¼","ê´´ì—ê°€íŠ¼?",
    "êµ¬ì”¹","êµ¿ë³´ì§€","ê·€ë‘","ê·¸ë‚˜ë¬¼ì—","ê¹€ëŒ€ì¤‘","ê¹€ì¹˜ë…€","ê¼­ì§€","ê¹¨ìŒ”ë¼","ë‚˜ë¹¼ì…","ë‚˜ìœìƒˆë¼","ë‚œìë§ˆì…”","ë‚œìë¨¹ì–´","ë‚œìí•§ì•„","ë‚´êº¼ë¹¨ì•„","ë‚´êº¼í•§ì•„","ë‚´ë¯¸ë„","ë‚´ë¯¸ëŸ´","ë‚´ë²„ì§€",
    "ë‚´ì”¨ë°œ","ë‚´ìì§€","ë‚´ì ì§€","ë‚´ì¡°ì§€","ë„ˆê±°ì• ë¹„","ë…„ë†ˆ","ë…¸ë„¤ë“¤","ë…¸ë¬´ë…¸ë¬´","ë…¸ì•Œë¼","ë…¸ë¬´í˜„","ë‡Œí……","ë‡¨ì˜¨","ë‡¬","ëˆ„ë‚˜ê°•ê°„","ëŠê·¸ë§¤","ëŠ¬ë¯œ","ëŠ¬ë¯¸","ë‹ˆê¸°ë¯¸","ë‹ˆë…„","ë‹ˆë¯œ",
    "ë‹ˆë¯¸","ë‹ˆë¯¸ê¸°","ë‹ˆë¯¸ë„","ë‹ˆë¯¸ëŸ´","ë‹ˆì”¨ë¸Œë„","ë‹ˆì•„ë²”","ë‹ˆì•„ë²”?","ë‹ˆì• ë¯¸","ë‹ˆì• ë¹„","ë‹ˆí• ì• ë¹„","ë‹ê¸°ë¦¬","ë‹¥ì³","ë‹¥ì³ë¼","ë‹¥ì¹˜ì„¸","ë‹¬ë‹¬ì´","ë‹¬ë”¸ì´","ë‹³ì€ë…„","ëŒ€ê°€ë¦¬","ëŒ€ê°ˆ",
    "ëŒ€ì• ê°€ë¦¬","ëŒ€ì—ê°€ë¦¬","ëŒ€ìŒìˆœ","ë”ì–´ì—‰ì‹ ","ë”ì—‰ì‹ ","ë”ëŸ¬ìš´ë…„","ëœì€ìƒˆë¼","ëˆë…„","ëˆìƒˆë¼","ëŒì•˜ë„¤","ëŒìœ¼ë…„","ëŒì€ìƒˆë¼","ë™ìƒê°•ê°„","ë’ˆì ¸","ë’¤ì´ì¹˜ê¸°","ë’¤ì ¸ë¼","ë’¤ì ¸ë²„","ë’¤ì ¸ì•¼",
    "ë’¤ì ¸ì•¼ì§€","ë’¤ì ¸ìš”","ë’¤ì¡Œ","ë’¤ì§€ê² ","ë’¤ì§€ê³ ì‹¶","ë’¤ì§€ê¸¸","ë’¤ì§„ë‹¤","ë’¤ì§ˆ","ë’¤ì¹˜ê¸°","ë’·ì‡ì¹˜ê¸°","ë’·ì¹˜ê¸°","ë“œìœ¼ì‘ì‹ ","ë“œì‘ì‹ ","ë“±ì‹ ","ë””ì ¸ë¼","ë””ì¡Œ","ë””ì§€ê³ ","ë””ì§ˆ","ë”°ë¨¹ê¸°",
    "ë”°ë¨¹ëŠ”ë‹¤","ë”°ë¨¹ì–´","ë”°ë¨¹ì–´ì•¼ì§€","ë”°ë¨¹ì—ˆì–´","ë”°ë¨¹ì—ˆì§€","ë”°ë¨¹ì„ê¹Œ","ë”°ë¨¹ì","ë”°ì•„ì•Œë”°ë¦¬","ë”°ì•„ì•Œë”°ì•„ë¦¬","ë”°ì•Œë”°ë¦¬","ë”´ë…„","ë”¸ë‹¬ì´","ë”¸ë”¸ì´","ë– ë¼ì´","ë– ì–´ë¼ì•„ì´","ë– ì–´ë¼ì´",
    "ë˜ë¼ì´","ë˜ë¼ì¸","ë˜ì˜¤ë¼ì•„ì´","ë˜ì˜¤ë¼ì´","ë˜˜ì•„ì´","ë ë°”","ë ë°œ","ë ë°œë‡¬","ë ë²Œ","ë ë²¨","ë ë¶€ìš°ìš¸","ë ë¶€ìš¸","ë ë¶ˆ","ë ë¸Œìš¸","ë ë¸”","ë ë¸”ë„˜","ë ì´ë°”ì•Œ","ë ì´ë°œ","ë ì´ë²„ì–¼",
    "ë ì´ë²Œ","ë ì´ì´ë°œ","ë ì´ì´ë²Œ","ëŸ°ë…„","ëŸ¼ë“¤","ë¡¬ë“¤","ë§‰ê°„ë…„","ë§‰ëŒ€ì‘¤ì…”ì¤˜?","ë§‰ëŒ€í•§ì•„ì¤˜","ë§˜ì¶©","ë§›ê°„ë…„","ë§›ì—†ëŠ”ë…„","ë§›ì´ê°„ë…„","ë¨¸ê°ˆ","ë¯œì¹€","ë¯œì¹œ","ë¯¸ë¤","ë¯¸ì‹œì¹œë°œ",
    "ë¯¸ì³£ë„¤","ë¯¸ì³¤ë‚˜","ë¯¸ì³¤ë‹ˆ","ë¯¸ì·¬","ë¯¸ì¹€","ë¯¸ì¹˜ì¸","ë¯¸ì¹œ","ë¯¸ì¹œã…‹","ë¯¸ì¹œê°œ","ë¯¸ì¹œêµ¬ë…•","ë¯¸ì¹œêµ¬ë©","ë¯¸ì¹œë„˜","ë¯¸ì¹œë…„","ë¯¸ì¹œë†ˆ","ë¯¸ì¹œëˆ”","ë¯¸ì¹œìƒˆ","ë¯¸ì¹œìƒˆë¼","ë¯¸ì¹œìƒ‰","ë¯¸ì¹œì‰ì´",
    "ë¯¸ì¹œì”¨ë¶€ë„","ë¯¸í‹°ë„˜","ë¯¸í‹´","ë¯¸í‹´ê²ƒ","ë°íŒ","ë°”ì£¼ì¹´ìì§€","ë°œë†ˆ","ë°©ì ë±…","ë°±ë³´ì§€","ë²„ë”°ë¦¬ìì§€","ë²„ì–´ì–´ì§€","ë²„ì–´ì–´ì§€ì´","ë²„ì–´ì§€","ë²„ì–´ì§€ì´","ë²„ì§€êµ¬ë…•","ë²„ì§€êµ¬ë©","ë²„ì§€ëƒ„ìƒˆ",
    "ë²„ì§€ë”°ë¨¹ê¸°","ë²„ì§€ëš«ì–´","ë²„ì§€ëœ¨ë”","ë²„ì§€ë¬¼ë§ˆì…”","ë²„ì§€ë²Œë ¤","ë²„ì§€ë²Œë£Œ","ë²„ì§€ë¹¨ì•„","ë²„ì§€ë¹¨ì–´","ë²„ì§€ì°ì–´","ë²„ì§€ì‘¤ì…”","ë²„ì§€í„¸","ë²„ì§€í•§ì•„","ë²„ì§“ë¬¼","ë²„ì§“ë¬¼ë§ˆì…”","ë²Œì°½","ë²Œì°½ê°™ì€ë…„",
    "ë²µì‹ ","ë³„ì°½","ë³‘ë‹¥","ë³‘ë”±","ë³‘ë§›","ë³‘ì‹ ","ë³‘ì‹ ì„¸ë¦¬","ë³‘ì‹ ì…°ë¦¬","ë³‘ì‹ ì”¨ë°œ","ë³‘í¬","ë³´ì§€","ë³´ì§€êµ¬ë…•","ë³´ì§€êµ¬ë©","ë³´ì§€ë…€","ë³´ì§€ë”°ë¨¹ê¸°","ë³´ì§€ëš«ì–´","ë³´ì§€ëœ¨ë”","ë³´ì§€ë¨¸ë¦¬ë°•ê¸°",
    "ë³´ì§€ë¬¼","ë³´ì§€ë¬¼ë§ˆì…”","ë³´ì§€ë°•ì–´","ë³´ì§€ë²Œë ¤","ë³´ì§€ë²Œë£Œ","ë³´ì§€ë²Œë¦¬","ë³´ì§€ë²Œë¦¬ì","ë³´ì§€ë³´ì§€","ë³´ì§€ë¹¨ì•„","ë³´ì§€ë¹¨ì–´","ë³´ì§€ì—ìì§€ê»´","ë³´ì§€ì—ìì§€ë„ˆ","ë³´ì§€ìì§€","ë³´ì§€ì •ì•¡","ë³´ì§€ì¥ì–´ì§œ",
    "ë³´ì§€ì°Œì ¸","ë³´ì§€ì°¢ì–´","ë³´ì§€í„¸","ë³´ì§€í„¸ë½‘ì•„","ë³´ì§€í„¸ì–´","ë³´ì§€í‹€ë˜ê¸°","ë³´ì§€í•§ì•„","ë³´ì§€í•§ì•„ì¤„ê¹Œ","ë³´ì§€í•§ì•„ì¤˜","ë³´ì§€í•§ì–´","ë³´ì§“ë¬¼","ë³´ì§“ë¬¼ë§ˆì…”","ë´‰ì•Œ","ë¶€ë„","ë¶ˆì•Œ","ë¶•ì‹ ","ë¶•ì•Œ",
    "ë·°ìš°ì›…ì‹ ","ë·°ì›…ì‹œì¸","ë·°ì›…ì‹ ","ë¸…ì‹ ","ë¸Œë„","ë¹™ë¤","ë¹™ì‹ ","ë¹™ì‹ ì‰ì´","ë¹ ê°€ì•¼ë¡œ","ë¹ ê°€ëƒ","ë¹ ê°„ê°€","ë¹ ê°€ìƒˆ","ë¹ ê°€ë‹ˆ","ë¹ ê°€ì‹­ìƒˆ","ë¹ ê°€ì”¹ìƒˆ","ë¹ êµ¬ë¦¬","ë¹ êµ¬ìš¸","ë¹ êµ´",
    "ë¹ êµ´ì´","ë¹ ë„¤","ë¹ ë¼","ë¹ ì•„ê°€","ë¹ ì•„êµ¬ë¦¬","ë¹ ì•„êµ¬ìš°ë¦¬","ë¹ ì•„ì•„ë¼","ë¹ í","ë¹¡ìƒˆë¼","ë¹¨ì¹˜ì‚°","ë¹»ì•˜","ë¹»ì€","ë»ê·œ","ë»í","ë»‘ìœ ","ë»‘í","ë»¨í","ë¼ˆí","ë½€ì§€","ì‚¬ê¹Œì‰¬","ì‚¬ê¹Œì‹œ",
    "ì‚¬ê¹Œì‹œì´","ì‚¬ê¹Œì•„ì‹œ","ì‚¬ê¹Œì•„ì‹œì´","ì‚¬ìƒˆë¼","ìƒë…„","ìƒˆ77ã…£","ìƒˆã„²ã…£","ìƒˆë¼","ìƒˆë¼ë¼","ìƒˆë¼ì•¼","ìƒˆí€´","ìƒˆí‚ˆ","ìƒˆí‚¤","ìƒ‰í¬","ìƒ‰íˆ","ìƒŠê¸°","ìƒŠíˆ","ìƒ¹ë…„","ì„€í‚¤","ì„±ê´´","ì„±êµ",
    "ì„±êµí•˜ì","ì„±êµí•´","ì„±í­í–‰","ì„¸ë¼","ì„¸ì—‘ìŠ¤","ì„¸ì—‘ì“°","ì„¸í‚¤","ì„¹ë¼","ì„¹ìŠ¤","ì„¹ìŠ¤í•˜ì","ì„¹ìŠ¤í•´","ì†ŒìŒìˆœ","ì‡…ë¼","ì‡¡ë¼","ì‰ë¼","ì‰¬ë°•","ì‰¬ë°œ","ì‰¬ë°©ìƒˆ","ì‰¬ë²„","ì‰¬ë¹¡","ì‰¬ì´ë°”",
    "ì‰¬ì´ì´","ì‰¬ì´ì´ì´","ì‰¬ì´ì´ì´ì´","ì‰¬íƒ±","ì‰¬íŒ","ì‰¬í„","ì‰½ì„¸","ì‰½ì•Œë„˜","ìŠˆã…£ë°œ","ìŠˆë°œ","ìŠˆë²Œ","ìŠˆìš°ë²Œ","ìŠ¤ë²Œ","ìŠ¨ìƒë‹˜","ì‹‘ì°½","ì‹œëŒ•ì´","ì‹œë¯¸ë°œì¹œ","ì‹œë¯¸ì¹œë°œ","ì‹œë°”","ì‹œíŒŒ",
    "ì‹œë°”ë¼ì§€","ì‹œë°”ë¥˜","ì‹œë°”ì‹œë°”","ì‹œë°”ì•Œ","ì‹œë°”ì•™","ì‹œë°•ìƒ‰íˆ","ì‹œë°•ì‰‘íˆ","ì‹œë°œ","ì‹œë°œë…„","ì‹œë°œë†ˆ","ì‹œë°œìƒˆë¼","ì‹œë°©ìƒˆ","ì‹œë°©ìƒ‰í¬","ì‹œë°©ì‰‘í¬","ì‹œë²Œ","ì‹œë²Œíƒ±","ì‹œë³¼íƒ±","ì‹œë¶€ëŸ´",
    "ì‹œë¶€ë ¬","ì‹œë¶€ìš¸","ì‹œë·°ëŸ´","ì‹œë·°ë ¬","ì‹œë¹¡","ì‹œë¹¨","ì‹œìƒˆë°œë¼","ì‹œì´ë°œ","ì‹œì…ì„¸","ì‹œì…ì„¸ì—","ì‹œì¹œë°œë¯¸","ì‹œí‚¤ê°€","ì‹œíƒ±","ì‹œíŒ","ì‹œíŒìƒˆë¼","ì‹œíŒ”","ì‹œíŒ”ë„˜","ì‹œíŒ”ë…„","ì‹œíŒ”ë†ˆ",
    "ì‹œíŒ”ìƒˆë¼","ì‹œí„","ì‹­ë…€","ì‹­ë²„ì§€","ì‹­ë¶€ë„","ì‹­ë¶€ëŸ´","ì‹­ìƒˆ","ì‹­ì„¸","ì‹­ì„¸ë¦¬","ì‹­ì„¸ì´","ì‹­ì…°ë¦¬","ì‹­ì‰ë¼","ì‹­ìì„","ì‹­ììŠ¥","ì‹­ì§€ë„","ì‹­ì°½","ì‹­ì°½ë…€","ì‹­íƒ±","ì‹­íƒ±êµ¬ë¦¬","ì‹­íƒ±êµ´ì´",
    "ì‹­íŒ”","ì‹­íŒ”ë„˜","ì‹­íŒ”ìƒˆë¼","ì‹¸ê°€ì§€","ì‹¸ê°€ì§€ì—†","ì‹¸ë¬¼ì–´","ì‹¹ìŠ¤","ìŒë…„","ìŒë†ˆ","ìŒë³´ì§€","ìŒìŒë³´ì§€","ìŒ”ë¼","ìŒ”ì—‘ìŠ¤","ìŒ•ìŠ¤","ìŒ•ì“°","ì…","ì…ë†ˆ","ì…ë…„","ìŒë¼","ì„ë¼","ì„ë¦¬","ì„ì—‘ìŠ¤",
    "ì…ìŠ¤","ì…ì“°","ì’¸8","ì’¸ëŒ•","ì’¸ë°œ","ì’¸íŒ”","ì’¸í„","ì“°ëŒ•","ì“°ë…","ì“°ë˜ê¸°ê°™","ì“°ë ˆê¸°ìƒˆ","ì“°ë ‰","ì“°ë£¨","ì“°ë°”","ì“°ë°”ìƒˆë¼","ì“°ë°œ","ì“°ë²Œ","ì“°ë²¨","ì“°ë¸Œë„ì‰½ì„¸","ì“°íŒŒ","ì”Œ8","ì”ŒëŒ•","ì”Œë…",
    "ì”Œë°œ","ì”Œë²¨","ì”ŒíŒ”","ì”ì°½","ì”¨8","ì”¨ã…‚ã…","ì”¨ê°€ë­ë„˜","ì”¨ê°€ë­ë…„","ì”¨ê°€ë­ë†ˆ","ì”¨ê±¸","ì”¨ëŒ•","ì”¨ëŒ•ì´","ì”¨ë…","ì”¨ë°”","ì”¨ë°”ë¼","ì”¨ë°”ì•Œ","ì”¨ë°•ìƒ‰í¬","ì”¨ë°•ìƒ‰íˆ","ì”¨ë°•ì‰‘íˆ",
    "ì”¨ë°œ","ì”¨ë°œë…„","ì”¨ë°œë¡¬","ì”¨ë°œë³‘ì‹ ","ì”¨ë°©ìƒˆ","ì”¨ë°©ì„¸","ì”¨ë±…ê°€ë¦¬","ì”¨ë²„ëŸ¼","ì”¨ë²Œ","ì”¨ë²Œë…„","ì”¨ë²Œì‰ì´","ì”¨ë²Œíƒ±","ì”¨ë²¨","ì”¨ë³¼íƒ±","ì”¨ë¶€ë„","ì”¨ë¶€ëŸ´","ì”¨ë¶€ë ¬","ì”¨ë¶ˆì•Œ","ì”¨ë·°ëŸ´",
    "ì”¨ë·°ë ¬","ì”¨ë¸ŒëŸ´","ì”¨ë¸”","ì”¨ë¸”ë…„","ì”¨ë¸¡","ì”¨ë¸¡ìƒˆë¼","ì”¨ë¹„","ì”¨ë¹ ë¹ ","ì”¨ë¹¡","ì”¨ë¹¨","ì”¨ë»˜","ì”¨ìƒˆë°œë¼","ì”¨ì„¹ë¼","ì”¨ì´ë°œ","ì”¨ì…","ì”¨ì…ìƒˆ","ì”¨ì…ìƒˆì—","ì”¨ì…ì„¸","ì”¨ì…ì„¸ì—","ì”¨íŒŒë„˜",
    "ì”¨íŒ","ì”¨íŒë„˜","ì”¨íŒìƒˆë¼","ì”¨íŒì„¸ë¼","ì”¨íŒ”","ì”¨í","ì”¨íë„˜","ì”¨íë‡¬","ì”¨íë³´ì§€","ì”¨íìì§€","ì”¹","ì”¹ê·€","ì”¹ë…„","ì”¹ë•","ì”¹ëª»","ì”¹ë¬¼","ì”¹ë¯¸ë„","ì”¹ë²„ì§€","ì”¹ë³´ì§€","ì”¹ë¶€ë„","ì”¹ë¸Œë„",
    "ì”¹ë¹µêµ¬","ì”¹ë»ëŸ´","ì”¹ë½€ì§€","ì”¹ìƒˆ","ì”¹ìƒˆë¼","ì”¹ì„¸","ì”¹ì‰ë€Œ","ì”¹ìŒ”","ì”¹ìŒ”ë¼","ì”¹ìì„","ì”¹ììŠ¥","ì”¹ìì§€","ì”¹ì§€ë„","ì”¹ì°½","ì”¹ì°½ë…€","ì”¹ì¹˜","ì”¹íƒ±","ì”¹íƒ±êµ´ì´","ì”¹íƒ±ì´","ì”¹íŒ”","ì”¹íŒ”ë„˜",
    "ì”¹í• ","ì•„ê°€ë¦¬","ì•„ë‹¥","ì•„ì•„ê°€ë¦¬","ì•„ì˜¤ã……ã…‚","ì•„ì˜¤ì‹œë°”","ì•”ìºë…„","ì• ë¬´","ì• ë¯¸","ì• ë¯¸ë„","ì• ë¯¸ë³´ì§€","ì• ë¯¸ì”¨ë±…","ì• ë¯¸ìì§€","ì• ë¯¸ì¡ë…„","ì• ë¯¸ì¢ƒë¬¼","ì• ë¹„","ì• ì• ë¬´","ì• ì—ë¬´","ì• ì—ë¯¸","ì• ì—ë¹„",
    "ì•°ì°½","ì•¼dong","ì•¼ë™","ì–´ë¯¸ê°•ê°„","ì–´ë¯¸ë”°ë¨¹ì","ì–´ë¯¸ì‘¤ì‹œì","ì—„ì°½","ì—ë¬´","ì—ë¯¸","ì—ë¹„","ì—ì• ë¬´","ì—ì—ë¬´","ì—ì—ë¯¸","ì—ì—ë¹„","ì— ìƒ","ì— ì°½","ì—¬ì–´ì—„","ì—¬ì—„ë³‘","ì—¬ìã„¸ã…ë¨¹ê¸°","ì—¬ìã„¸ã…ë¬µê¸°",
    "ì—¬ìë”°ë¨¹ê¸°","ì—¬ìë”°ë¬µê¸°","ì—¼ë³‘","ì—¼ë³‘í• ","ì—¼ëµ¹","ì—¿ê°™","ì—¿ë¨¹ì–´ë¼","ì—¿ì´ë‚˜","ì˜˜ë³‘","ì˜¤ë¥´ê°€ì¦˜","ì™•ë²„ì§€","ì™•ìì§€","ì™•ì ì§€","ì™•í„¸ë²„ì§€","ì™•í„¸ë³´ì§€","ì™•í„¸ìì§€","ì™•í„¸ì ì§€","ì™œì €ëŸ¼","ì™¸í€´",
    "ìš”ë…„","ìœ ê¹","ìœ ë‘","ìœ ë‘ë¹¨ì–´","ìœ ë‘í•§ì–´","ìœ ë°œì¡°ë¬¼ë½","ìœ ë°©","ìœ ë°©ë§Œì ¸","ìœ ë°©ë¹¨ì•„","ìœ ë°©ì£¼ë¬¼ëŸ­","ìœ ë°©ìª¼ë¬¼ë”±","ìœ ë°©ìª¼ë¬¼ëŸ­","ìœ ë°©í•§ì•„","ìœ ë°©í•§ì–´","ìœ ìš°ê¹Œì••","ìœ ìš°ê¹","ìœ ìš°ë°©",
    "ìœ ìš°ìš°ë°©ê²ƒ","ìœ¡ê°‘","ì€ë…„","ì€ìƒˆë¼","ìŒê²½","ì´ë…„","ì´ìƒˆë¼","ìê¸°í•§ì•„","ìì••ê²ƒ","ììœ„","ìì§€","ìì§€êµ¬ë…•","ìì§€êµ¬ë©","ìì§€ê½‚ì•„","ìì§€ë„£ì","ìì§€ëœ¨ë”","ìì§€ëœ¯ì–´","ìì§€ë°•ì–´","ìì§€ë¹¨ì•„",
    "ìì§€ë¹¨ì•„ì¤˜","ìì§€ë¹¨ì–´","ìì§€ì‘¤ì…”","ìì§€ì“°ë ˆê¸°","ìì§€ì •ê°œ","ìì§€ì§¤ë¼","ìì§€í„¸","ìì§€í•§ì•„","ìì§€í•§ì•„ì¤˜","ìì§€í•§ì–´","ì‘ì€ë³´ì§€","ì ì§€","ì§¬ì§€","ì ì§€ëš«ì–´","ì ì§€ë¬¼ë§ˆì…”","ì ì§€í„¸","ì ì§“ë¬¼ë§ˆì…”",
    "ì¡ê²ƒ","ì¡ë…„","ì¡ë†ˆ","ì €ë…„","ì €ì—‡","ì €ì—Š","ì ê¹Œ","ì ˆë¼","ì ë¬¼","ì “ê°€íŠ¼ì‰ì´","ì “ê°™ë‚´","ì “ê¹Œ","ì “ëƒ„ìƒˆ","ì “ëŒ€ê°€ë¦¬","ì “ë– ","ì “ë§Œì´","ì “ë¬¼","ì “ë¬¼ëƒ„ìƒˆ","ì “ë°¥","ì •ì•¡ë§ˆì…”","ì •ì•¡ë¨¹ì–´",
    "ì •ì•¡ë°œì‚¬","ì •ì•¡ì§œ","ì •ì•¡í•§ì•„","ì •ìë§ˆì…”","ì •ìë¨¹ì–´","ì •ìí•§ì•„","ì –ê°™","ì –ê¹Œ","ì –íƒ±ì´","ì —ê°™","ì ¼ë‚˜","ì ¼ë‚°","ì¡Œê°™ì€","ì¡ê°™","ì¡°ê°€íŠ¼","ì¡°ê°œë„“ì€ë…„","ì¡°ê°œë”°ì¡°?","ì¡°ê°œë§ˆì…”ì¤˜?","ì¡°ê°œë²Œë ¤ì¡°?",
    "ì¡°ê°œë³´ì§€","ì¡°ê°œì†ë¬¼","ì¡°ê°œì‘¤ì…”ì¤˜?","ì¡°ê°œí•§ì•„ì¤˜?","ì¡°ê¹Ÿ","ì¡°ë˜","ì¡°ì˜¤ê°€íŠ¼","ì¡°ì˜¤ê¹ŒíŠ¼","ì¡°ì˜¤ë˜","ì¡°ì˜¤ì˜¤ì¡°","ì¡°ì˜¤ì˜¨ë‹ˆ","ì¡°ì˜¤ì˜¬ë¼","ì¡°ì˜¤ìš°ê¹ŒíŠ¼","ì¡°ì˜¤ì›ƒ","ì¡°ì˜¤ì§€","ì¡°ì˜¨","ì¡°ì˜¨ë‚˜",
    "ì¡°ì˜¨ë‹ˆ","ì¡°ì˜¨ë§ˆë‹ˆ","ì¡°ì˜¨ë§Œ","ì¡°ì˜¬ë¼","ì¡°ì˜´ë§ˆë‹ˆ","ì¡°ì˜·ë§Œ","ì¡°ìš°ê¹ŒíŠ¼","ì¡±ê°™ë‚´","ì¡±ê¹Œ","ì¡±ê¹Œë‚´","ì¡´.ë‚˜","ì¡´ã„´ë‚˜","ì¡´ê·€","ì¡´ê·˜","ì¡´ë‚˜","ì¡´ë‚˜ì•„","ì¡´ë‚™","ì¡´ë‚´","ì¡´ë‹ˆ","ì¡´ë˜‘","ì¡´ë§ˆë‹ˆ",
    "ì¡´ë§›","ì¡´ë©‹","ì¡´ë²„","ì¡´ì‹«","ì¡´ì„","ì¡´ì¼","ì¡´ì˜ˆ","ì¡´ì›ƒ","ì¡´ì˜","ì¡´ì¼","ì¡´ì¢‹","ì¡´íŠ¸","ì¡¸ê·€","ì¡¸ê·˜","ì¡¸ë¼","ì¡¸ë§›","ì¡¸ë©‹","ì¡¸ì‹«","ì¡¸ì˜ˆ","ì¡¸ì›ƒ","ì¡¸ì¼","ì¡¸ì¢‹","ì¢€ë§ˆë‹ˆ","ì¢€ë¬¼","ì¢€ì“°ë ˆê¸°",
    "ì¢ë°¥","ì¢ë¹ ë¼ë¼","ì¢ƒ","ì¢ƒê°€íŠ¼ë‡¬","ì¢ƒê°„ë…„","ì¢ƒê¹Œ","ì¢ƒê¹Œë¦¬","ì¢ƒê¹Ÿë„¤","ì¢ƒëƒ„ìƒˆ","ì¢ƒë„˜","ì¢ƒëŒ€ê°€ë¦¬","ì¢ƒë„","ì¢ƒë˜","ì¢ƒë§ˆë¬´ë¦¬","ì¢ƒë§Œì•„","ì¢ƒë§Œì´","ì¢ƒë§Œí•œê²ƒ","ì¢ƒë§Œí•œì‰ì´","ì¢ƒë¬¼","ì¢ƒë¬¼ëƒ„ìƒˆ",
    "ì¢ƒë³´ì§€","ì¢ƒë¶€ë„","ì¢ƒë¹ êµ¬ë¦¬","ì¢ƒë¹ ë„¤","ì¢ƒë¹ ë¼ë¼","ì¢ƒí„¸","ì¢…ë‚˜","ì¢†","ì¢†ê°™ì€ë†ˆ","ì¢†ê°™ì€ìƒˆë¼","ì¢†ê¹Œ","ì¢†ê¹Œë¼","ì¢†ë‚˜","ì¢†ë…„","ì¢†ë„","ì¢†ë§Œì•„","ì¢†ë§Œí•œë…„","ì¢†ë§Œí•œë†ˆ","ì¢†ë§Œí•œìƒˆë¼","ì¢†ë¨¹ì–´",
    "ì¢†ë¬¼","ì¢†ë°¥","ì¢†ë¹¨ì•„","ì¢†ìƒˆë¼","ì¢†í„¸","ì¢‡","ì¢‹ë§Œ","ì¢‹ë§Œí•œê²ƒ","ì¢‹ì˜¤ì›ƒ","ì£ ë‚¸","ì£ ì˜¨ë‚˜","ì£¤ë‚˜","ì£¤ë‚´","ì£µë‚˜","ì£¶","ì£¼ê¸€ë…„","ì£¼ê¸¸ë…„","ì£¼ë‘¥ì´","ì£¼ë‘¥ì•„ë¦¬","ì¤¬ê°™ì€","ì¥ë„","ì¥°ë‚˜",
    "ì¥°ë‚´","ì¥°ë‹ˆ","ì¥°íŠ¸","ì¦¤ë„","ì§€ê»„ì´","ì§€ë„","ã…ˆ1ë„","ì§€ëŸ´","ì§€ë¡¤","ì§€ë¢€","ì§€ë¢°","ì§€ì´ë¼ì•Œ","ì§€ì´ë„","ì§±ê¹¨","ì§±ê»˜","ìª¼ë…œ","ìª¼ë‹¤","ìª¼ë‹¤ìƒˆë¼","ìª½ë°”ë¦¬","ìª½ë°œ","ì«‚","ì«“ê°™","ì¬°ì˜",
    "ì¬²","ì°ì§¸ë¼","ì°½ë‚¨","ì°½ë…€","ì°½ë…€ë²„ì§€","ì°½ë…„","ì°½ë…„ë²¼ì§€","ì°½ë†ˆ","ì²˜ë¨¹","ì²«ë¹ ","ì³ë§ˆ","ì³ë¨¹","ì³ë°›ëŠ”","ì³ë°œë¼","ì³ì‘¤ì…”ë°•ì–´","ì´Œì”¨ë¸Œë¼ë¦¬","ì´Œì”¨ë¸Œë‘ì´","ì´Œì”¨ë¸Œë­ì´","ì·¨ã…ˆ","ì·¨ì¢ƒ",
    "ì¹œêµ¬ë…„","ì¹œë…„","ì¹œë…¸ë§ˆ","ì¹œë†ˆ","ìºëŸ¿ë‹·ì»´","í¬ë¦¬í† ë¦¬ìŠ¤","í°ë³´ì§€","í´ë¦¬í† ë¦¬ìŠ¤","í„°ë˜ê¸°í„°ë˜ê¸°","íŒŒì¹œ","í‘ê¸€","í˜ë‹ˆìŠ¤","í•­ë¬¸","í•­ë¬¸ìˆ˜ì…”","í•­ë¬¸ì‘¤ì…”","í—ˆë²„ë¦¬ë…„","í—ˆë²Œ","í—ˆë²Œë…„","í—ˆë²Œë ˆ",
    "í—ˆë²Œë³´ì§€","í—ˆë²Œìì‹","í—ˆë²Œìì§€","í—ˆì–´ë²Œ","í—ë ë³´ì§€","í˜€ë¡œë³´ì§€í•§ê¸°","í˜¸ëƒ¥ë…„","í˜¸ë¡œ","í˜¸ë¡œìƒˆë¼","í˜¸ë¡œì","í˜¸ë¡œììŠ¥","í˜¸ë¡œìì‹","í˜¸ë¡œì¡","í˜¸ë£¨ììŠ¥","í™”ë‚­ë…„","í™”ëƒ¥ë…„","í›„.ë ¤","í›„ë¼ëœ",
    "í›„ë¼ëœë„˜","í›„ë ¤","í›„ìš°ìì•™","í›„ìš°ì¥","í›„ì¥","í›„ì¥ê½‚ì•„","í›„ì¥ëš«ì–´","í›„ì¥ëš«ì–´18ì„¸í‚¤","ê½ƒíœ´","sibal","ë¯¸ì¹­ëŸ¼","ã…‚ã……","ê±”ì„€","ëŠê¸ˆ","ëŠê¸ˆë§ˆ","ëŠ‘ìŒ","ã…ˆê°™","ã…ˆê°™ë„¤","ã…—"]    

# ìƒˆë¡œ ë‹¤ìš´ë¡œë“œí•œ ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸°
model = BertForSequenceClassification.from_pretrained("bert-base-uncased")

# ëª¨ë¸ êµ¬ì¡° ë³€ê²½: ì„ë² ë”© ë ˆì´ì–´ì˜ í¬ê¸°ë¥¼ ìƒíƒœ ì‚¬ì „ê³¼ ì¼ì¹˜ì‹œí‚´
model.bert.embeddings.word_embeddings = torch.nn.Embedding(119547, 768, padding_idx=0)

# ìƒíƒœ ì‚¬ì „ ë¶ˆëŸ¬ì˜¤ê¸°
state_dict = torch.load('C:/dev/miniproject/mysite/mysite/model/model_emotion.pth', map_location=torch.device('cpu'))

# ëª¨ë¸ì˜ ë‹¤ë¥¸ ê°€ì¤‘ì¹˜ë“¤ì„ ë¶ˆëŸ¬ì˜¨ ìƒíƒœ ì‚¬ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸
model.load_state_dict(state_dict, strict=False)

# ëª¨ë¸ì„ í‰ê°€ ëª¨ë“œë¡œ ì„¤ì •
model.eval()

# ëª¨ë¸ì˜ ê°€ì¤‘ì¹˜ í¬ê¸° ë¹„êµ
for name, param in model.named_parameters():
    if name in state_dict:
        print(f"Parameter name: {name}, Model shape: {param.shape}, State dict shape: {state_dict[name].shape}, Matches: {param.shape == state_dict[name].shape}")
    else:
        print(f"Parameter name: {name}, No matching entry in state dict")

## ì…ë ¥ ë°ì´í„° ë³€í™˜
def convert_input_data(sentences):
    tokenizer = BertTokenizer.from_pretrained('bert-base-uncased', do_lower_case=True)
    tokenized_texts = [tokenizer.tokenize(sent) for sent in sentences]
    MAX_LEN = 128
    input_ids = [tokenizer.convert_tokens_to_ids(x) for x in tokenized_texts]
    input_ids = pad_sequences(input_ids, maxlen=MAX_LEN, dtype="long", truncating="post", padding="post")
    attention_masks = []
    for seq in input_ids:
        seq_mask = [float(i > 0) for i in seq]
        attention_masks.append(seq_mask)
    inputs = torch.tensor(input_ids)
    masks = torch.tensor(attention_masks)
    return inputs, masks

# ë¬¸ì¥ í…ŒìŠ¤íŠ¸
def test_sentences(sentences):
    model.eval()
    inputs, masks = convert_input_data(sentences)
    b_input_ids = inputs
    b_input_mask = masks
    with torch.no_grad():
        outputs = model(b_input_ids,
                        token_type_ids=None,
                        attention_mask=b_input_mask)
    logits = outputs[0]
    logits = logits.detach().cpu().numpy()
    return np.argmax(logits)

@login_required(login_url='common:login')
def answer_create(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    if request.method == "POST":
        form = AnswerForm(request.POST)
        if form.is_valid():
            answer = form.save(commit=False)
            answer.author = request.user
            answer.create_date = timezone.now()
            answer.question = question
            #answer.add_emoji_based_on_sentiment()
            sentiment = test_sentences([answer.content])
            emoji = 'ğŸ˜Š' if sentiment == 1 else 'ğŸ˜'
            answer.content = answer.content + emoji
            
            for i in lst :
                if i in answer.content: 
                    answer.content = "ë¹„ì†ì–´ê°€ í¬í•¨ëœ ëŒ“ê¸€ì…ë‹ˆë‹¤."
                else : 
                    answer.content
            answer.save()
            return redirect('{}#answer_{}'.format( 
                resolve_url('pybo:detail', question_id=question.id), answer.id))
    else:
        form = AnswerForm()
    context = {'question': question, 'form': form}
    return render(request, 'pybo/question_detail.html', context)

@login_required(login_url='common:login')
def answer_modify(request, answer_id):
    answer = get_object_or_404(Answer, pk=answer_id)
    if request.user != answer.author:
        messages.error(request, 'ìˆ˜ì •ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤')
        return redirect('pybo:detail', question_id=answer.question.id)
    if request.method == "POST":
        form = AnswerForm(request.POST, instance=answer)
        if form.is_valid():
            answer = form.save(commit=False)
            answer.modify_date = timezone.now()
            answer.save()
            return redirect('{}#answer_{}'.format(
                resolve_url('pybo:detail', question_id=answer.question.id), answer.id))
    else:
        form = AnswerForm(instance=answer)
    context = {'answer': answer, 'form': form}
    return render(request, 'pybo/answer_form.html', context)


@login_required(login_url='common:login')
def answer_delete(request, answer_id):
    answer = get_object_or_404(Answer, pk=answer_id)
    if request.user != answer.author:
        messages.error(request, 'ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')
    else:
        answer.delete()
    return redirect('pybo:detail', question_id=answer.question.id)

@login_required(login_url='common:login')
def answer_vote(request, answer_id):
    answer = get_object_or_404(Answer, pk=answer_id)
    if request.user == answer.author:
        messages.error(request, 'ë³¸ì¸ì´ ì‘ì„±í•œ ê¸€ì€ ì¶”ì²œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
    else:
        answer.voter.add(request.user)
    return redirect('{}#answer_{}'.format(
                resolve_url('pybo:detail', question_id=answer.question.id), answer.id))

@login_required(login_url='common:login')
def detail(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    answers = question.answer_set.all()
    

    
    context = {'question': question, 'answers': answers}
    return render(request, 'pybo/question_detail.html', context)